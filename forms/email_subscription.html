<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Flick Chess</title>
        <link rel="shortcut icon" href="./favicon.ico"/>
        
        <!-- FOUNDATION -->
    	<link rel="stylesheet" type="text/css" href="/css/foundation.css" />
    	<link rel="stylesheet" type="text/css" href="/css/normalize.css" />
        <!-- FLICKCHESS CSS -->
		<link rel="stylesheet" type="text/css" href="/css/main.css"/>
        
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        
        <!-- JQUERY -->
		<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
        <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        
        <script src="/js/vendor/modernizr.js"></script>
        
		<!-- FOUNDATION -->		
		<script src="/js/foundation/foundation.js"></script>
		<script src="/js/foundation/foundation.accordion.js"></script>
		<script src="/js/foundation/foundation.alert.js"></script>
		<script src="/js/foundation/foundation.tab.js"></script>
		<script src="/js/foundation/foundation.topbar.js"></script>
        
        <script src="/js/flickchess.js"></script>
        
        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        
        ga('create', 'UA-62592524-3', 'auto');
        ga('send', 'pageview');
        
        setTimeout(function(){var a=document.createElement("script");
        var b=document.getElementsByTagName("script")[0];
        a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0037/5504.js?"+Math.floor(new Date().getTime()/3600000);
        a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
        </script>
    </head>
    <body>      
        <!--<header class="page-wrapper">
            <div class="row">
                <div class="small-7 small-offset-5 medium-3 medium-offset-9 columns socialLinksHolder">
                    <a class="socialIcon youtube fa fa-youtube fa-2x" href="https://www.youtube.com/channel/UCCZ4-nqLfNOVwoGmZ5xebOQ" target="_blank"><span>Youtube</span></a>
                    <a class="socialIcon twitter fa fa-twitter fa-2x" href="https://twitter.com/flickchess" target="_blank"><span>Twitter</span></a>
                    <a class="socialIcon facebook fa fa-facebook-square fa-2x" href="https://www.facebook.com/flickchess" target="_blank"><span>Facebook</span></a>
                </div>
            </div>
        </header>-->
        
        <div class="content page-wrapper">
            <div id="main" class="row section">				
                <div class="small-12 medium-6 medium-offset-3 large-6 large-offset-0 columns">
                    <img name="logo" class="logo shadowed" src="../images/flickChess_forget.png"/>                  
                </div>

                <div class="large-6 show-for-large-up columns">
                    <div id="desktopPlayer" class="trailerHolder">                    
                        <div class="trailerPlay shadowed small">
                            <i class="fa fa-play-circle fa-4x shadowed"></i>
                        </div>
                        <div class="videoDemo"></div>                    
                    </div>            

                    <div id="subscribeForm">
                        <label>Want to help us make this game awesome? Join our alpha testing team, be part of the credits and receive the full version!</label>
                        <input type="text" class="subscribeEmail" name="email" placeholder="Email"/>
                        <button class="buttonSend formButton">I am in!</button>
                        <p class="feedbackMessage">Thanks for stopping by!</p>
                    </div>                 
                </div>  
            </div>
            <!--FOR MOBILE-->
            <div class="row hide-for-large-up">
                <div class="small-12 medium-6 medium-offset-3 columns">
                    <div id="mobilePlayer" class="trailerHolder">                    
                        <div class="trailerPlay shadowed small">
                            <i class="fa fa-play-circle fa-4x shadowed"></i>
                        </div>
                        <div class="videoDemo"></div>                    
                    </div>                
                </div>
            </div>
            <div class="row hide-for-large-up">
                <div class="small-12 medium-6 medium-offset-3 columns">
                    <div id="subscribeForm">
                        <label>Want to help us make this game awesome? Join our alpha testing team, be part of the credits and receive the full version!</label>
                        <input type="text" class="subscribeEmail" name="email" placeholder="Email"/>
                        <button class="buttonSend formButton">I am in!</button>
                        <p class="feedbackMessage">Thanks for stopping by!</p>
                    </div>
                </div>
            </div>        
    	</div>        
            
        <footer class="page-wrapper">
            <div class="row">
                <div class="small-6 small-centered medium-5 large-3 columns">
                    <div class="socialLinksHolder">
                        <a class="socialIcon youtube fa fa-youtube fa-2x" href="https://www.youtube.com/channel/UCCZ4-nqLfNOVwoGmZ5xebOQ" target="_blank"><span>Youtube</span></a>
                        <a class="socialIcon twitter fa fa-twitter fa-2x" href="https://twitter.com/flickchess" target="_blank"><span>Twitter</span></a>
                        <a class="socialIcon facebook fa fa-facebook-square fa-2x" href="https://www.facebook.com/flickchess" target="_blank"><span>Facebook</span></a>
                    </div>                    
                </div>
            </div>
            
            <a id="samaLogo" href="http://www.samasama-studios.com" target="_blank"><span>an idea from Sama Sama Studios</span></a>
        </footer>
    </body>
</html>

<script>
    $(document).ready(function() {

        var language = getQueryVariable("lang");
        if (language == "ee") {
            window.document.logo.src = '/images/flickChess_ee.png';
        }
        
        /*TRAILER PLAY*/
        $('.trailerPlay').on('click',function(){
            videoInit($(this).parent().prop('id'), 'https://www.youtube.com/embed/u_HmdgDyuhI?autoplay=1');
            
            $(this).hide();
        });
        
        $('.buttonSend').on('click', function(e) {            
            
            e.preventDefault();
            
            $(".feedbackMessage").each(function(index) {
                $(this).hide();
            });            
            $(".buttonSend").each(function(index) {            
                $(this).hide();
            });
		
            var data = {};
            var email;
            $(".subscribeEmail").each(function(index) {
                if ($(this).val() != '') {
                    email = $(this).val();
                    email = email.toLocaleLowerCase();
                    data['email'] = email;
                }
            });            
            
            if (validateEmail(email)) {
                var requestURL = 'http://97ba2ad.ngrok.com/api/flickchess/subscribe';
                $.ajax({                    
                    url: requestURL,                    
                    contentType: 'application/json',
                    type: 'POST',
                    data: JSON.stringify(data),
                    success: function(data) {
                        console.debug(data);
                        if (data == 'success') {
                            console.debug('ok');
                            $(".feedbackMessage").each(function(index) {
                                $(this).html('Thanks for stopping by!');
                                $(this).show();
                            });
                            $(".subscribeEmail").each(function(index) {
                                $(this).val("");
                            });
                            $(".buttonSend").each(function(index) {            
                                $(this).show();
                            });
                        } else {
                            $(".feedbackMessage").each(function(index) {                                
                                $(this).html(data);
                                $(this).show();
                            });
                            $(".buttonSend").each(function(index) {            
                                $(this).show();
                            });
                        }                        
                    },
                    failure: function(errMsg) {
                        $(".feedbackMessage").html(errMsg);
                        $(".feedbackMessage").show();
                        $(".buttonSend").each(function(index) {            
                            $(this).show();
                        });
                    }
                });                
            } else {
                $(".feedbackMessage").html('Invalid email');
                $(".feedbackMessage").show();
                $(".buttonSend").show();
            }
        });
    });
    
    function validateEmail(email) {
        var re = /\S+@\S+\.\S+/;
        return re.test(email);
    }    

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
        var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        //alert('Query Variable ' + variable + ' not found');
    }
    
    function videoInit(wrapper, url) {        
        var iframe = $('<iframe>',{
            src: url,
            width: '100%',
            height: '100%',
            frameborder:'0',
            allowTransparency: true,
            allowFullScreen: '', 
            webkitallowfullscreen: '', 
            mozallowfullscreen: ''
        });

        $("#"+wrapper+" .videoDemo").append(iframe); 
        $("#"+wrapper+" .videoDemo").show();
    }
</script>
